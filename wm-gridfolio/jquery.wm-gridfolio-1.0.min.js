/*!
 * jquery.wm-gridfolio - v 1.0
 * desenvolvido por Welison Menezes
 * email : welisonmenezes@gmail.com
 * 
 *
 * Copyright 2014 Welison Menezes
 * @license http://www.opensource.org/licenses/mit-license.html MIT License
 * @license http://www.gnu.org/licenses/gpl.html GPL2 License 
 */

!function(e){"use strict";e.fn.extend({WMGridfolio:function(n){var i={selectors:{item:"wmg-item",thumbnail:"wmg-thumbnail",details:"wmg-details",close:"wmg-close",arrow:"wmg-arrow"},thumbnail:{columns:6,minSize:100,margin:5},details:{minHeight:400,speed:350,full_w:!1},config:{open:"open",openToTop:!0,hasImg:!0,keepOpen:!1,onlyThumb:!1},callbacks:{CB_LoadGrid:!1,CB_ResizeGrid:!1,CB_OpenDetail:!1,CB_CloseDetail:!1,CB_CloseAll:!1}},n=e.extend(!0,i,n),t={container:!1,element:!1,thumbnail:!1,details:!1,close:!1,CB_LoadGrid:function(){e.isFunction(n.callbacks.CB_LoadGrid)&&n.callbacks.CB_LoadGrid.apply(this,arguments)},CB_ResizeGrid:function(){e.isFunction(n.callbacks.CB_ResizeGrid)&&n.callbacks.CB_ResizeGrid.apply(this,arguments)},CB_OpenDetail:function(){e.isFunction(n.callbacks.CB_OpenDetail)&&n.callbacks.CB_OpenDetail.apply(this,arguments)},CB_CloseDetail:function(){e.isFunction(n.callbacks.CB_CloseDetail)&&n.callbacks.CB_CloseDetail.apply(this,arguments)},CB_CloseAll:function(){e.isFunction(n.callbacks.CB_CloseAll)&&n.callbacks.CB_CloseAll.apply(this,arguments)}},s={getWidthColumn:function(e){for(var i=e,t=i.width(),s=n.thumbnail.columns,a=t/s;a<=n.thumbnail.minSize;){if(t<=n.thumbnail.minSize)return!1;s-=1,a=t/s}return a},openContent:function(i){var s=i,a=s.parent(),o=n.selectors.details,l=n.selectors.arrow,c=n.config.open,r=n.details.speed,d=e("."+o).find("> div").height(),m=n.selectors.close,p=d+(30-2*n.thumbnail.margin);if(s.addClass(c),s.parent().addClass(c),n.config.keepOpen===!0?(a.css({"margin-bottom":p+"px"}).addClass("wm-margin"),a.find("."+o).css({height:p+"px"}).addClass(c),t.CB_OpenDetail()):(a.animate({"margin-bottom":p+"px"},r).addClass("wm-margin"),a.find("."+o).stop().animate({height:p+"px"},r,function(){t.CB_OpenDetail()}).addClass(c),a.find("."+l).show()),n.config.openToTop&&a.offset()){var f=a.offset().top;e("html, body").animate({scrollTop:f},"500")}t.container=a.parent(),t.element=a,t.thumbnail=s,t.details=a.find("."+o),t.close=a.find("."+m)},closeContent:function(i,a){var o=i,l=a,c=n.selectors.details,r=n.selectors.thumbnail,d=n.selectors.item,m=n.selectors.arrow,p=n.selectors.close,f=n.config.open,h=n.details.speed;if(o.find("."+r).removeClass(f),o.find("."+d).removeClass(f),n.config.keepOpen===!0){var C=o.find(".wm-margin"),u=o.find("."+f);C.removeClass("wm-margin"),u.removeClass(f),l&&s.openContent(l),C.css({"margin-bottom":"0px"}),u.css({height:"0px"}),t.CB_CloseDetail()}else o.find(".wm-margin").animate({"margin-bottom":"0px"},h+50).removeClass("wm-margin"),o.find("."+c+"."+f).stop().animate({height:"0px"},h,function(){e(this).removeClass(f),l&&s.openContent(l),t.CB_CloseDetail()});o.parent().find("."+m).hide(),t.container=o,t.element=l===!1?o.find("."+d):l.parent(),t.thumbnail=l===!1?o.find("."+r):l,t.details=l===!1?o.find("."+c):l.parent().find("."+c),t.close=l===!1?o.find("."+p):l.parent().find("."+p)}},a={dynamicCSS:function(i,t,a,o){var l=i,c=t,r=a,d=o,m=n.selectors.details,p=s.getWidthColumn(l),f=n.config.open,h=n.thumbnail.margin,C=r.width()/2-2*h,u=e("."+m).find("> div").height(),g=u+(30-2*h);e("."+m).hasClass(f)&&(e("."+n.selectors.item+"."+f).css({"margin-bottom":g+"px"}),e("."+m+"."+f).css({height:g+"px"})),c.css({width:p+"px",height:p+"px"}),d.css({left:C+"px"}),n.config.hasImg&&(r.css({"line-height":Math.floor(p-2*h-1)+"px"}),r.find("img").css({"max-width":Math.ceil(p-2*h)+"px","max-height":Math.ceil(p-2*h)+"px"}))},toogleContent:function(i,t){var a=i,o=t;o.each(function(){var i=e(this),t=n.config.open;i.on("click",function(){return e(this).hasClass(t)?!1:(i.parent().parent().hasClass(t)?s.closeContent(a,i):s.openContent(i),i.parent().parent().addClass(t),!1)})})},hideContent:function(i){i.on("click",function(){var i=e(this),a=i.parent().parent().parent(),o=n.config.open;s.closeContent(a,!1),a.removeClass(o),t.CB_CloseAll()})},staticCSS:function(e,i,t,s,a){var o=i,l=s,c=n.thumbnail.margin;l.css({height:"0px"}),l.find("> div").css({"min-height":n.details.minHeight}),n.details.full_w||l.find("> div").css({"margin-left":c,"margin-right":c}),o.css({padding:c+"px"})}};return this.each(function(){var i=e(this),s=i.find("."+n.selectors.item),o=i.find("."+n.selectors.thumbnail),l=i.find("."+n.selectors.details),c=i.find("."+n.selectors.close),r=i.find("."+n.selectors.arrow);t.container=i,t.element=s,t.thumbnail=o,t.details=l,t.close=c,a.staticCSS(i,s,o,l,r),n.config.onlyThumb===!1&&(a.toogleContent(i,o),a.hideContent(c)),a.dynamicCSS(i,s,o,r),setTimeout(function(){a.dynamicCSS(i,s,o,r),t.CB_LoadGrid(),i.css({filter:"alpha(opacity=100)",zoom:"1",opacity:"1"})},100),e(window).resize(function(){a.dynamicCSS(i,s,o,r),setTimeout(function(){a.dynamicCSS(i,s,o,r),t.CB_ResizeGrid()},100)})})}})}(jQuery);